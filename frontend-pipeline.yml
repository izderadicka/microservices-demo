default:
  image: izderadicka/nodechrome
  tags: 
    - microservices
# Cache downloaded dependencies and plugins between builds.
# To keep cache across branches add 'key: "$CI_JOB_NAME"'
  cache:
    paths:
      - .npm/
    key:
      files: 
      - angular-tutorial-heroes/package-lock.json

build-test:
  stage: test
  script:
  - cd angular-tutorial-heroes
  - npm ci --cache ../.npm --prefer-offline
  - npm run build
  - npm run test
  artifacts:
    expire_in: 1 day
    paths:
      - angular-tutorial-heroes/dist/


deploy-image:
  stage: deploy
  image: docker:stable
  services:
    - docker:stable-dind
  variables:
    DOCKER_IMAGE: izderadicka/ms-demo-front-end
  dependencies:
    - build-test
  script:
    - cd angular-tutorial-heroes
    # - docker build -t $DOCKER_IMAGE .
    # - echo $DOCKER_PWD | docker login -u $DOCKER_USER --password-stdin
    # - docker push $DOCKER_IMAGE

    